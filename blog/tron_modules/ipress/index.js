(function(a){if(typeof exports=="object"||typeof exports==="function"&&typeof module=="object"){module.exports=a()}else{if(typeof define=="function"&&define.amd){return define([],a)}else{window.iPress=a()}}})(function(){var c=new Class(function(){this.error=0;this.iControler=new a();this.iEvent=new b();if(typeof this.PressURL==="function"){this.token=this.PressURL(this.getURL())}else{this.token=this._PressURL(this.getURL())}});c.add("errors",{"0":"正常","404":"找不到页面地址","500":"服务端出错"});c.add("getURL",function(){var d=http.emit(Request.QueryString);if(d.length>0){return d[0]}else{return"page:home.html"}});c.add("setURL",function(h,d,k){var f="?"+h+":";if(d){f+="@"+d}var e=[],j="";if(k){for(var g in k){e.push(g+"("+k[g]+")")}}if(e.length>0){j="-"+e.join("-")}f+=j+".html";return f});c.add("_PressURL",function(d){var e={controler:"page",searchers:{},views:"home"};var f=d.split(":");if(f.length>1){e.controler=f[0];f=f[1].split(".");if(f.length>1){f=f[0].split("-");f.forEach(function(g){if(/^\@/.test(g)){e.views=g.replace(/^\@/,"")}else{if(/(\w+)(\(([^\)]+)\))?/.test(g)){var h=/(\w+)(\(([^\)]+)\))?/.exec(g);if(h&&h[1]){e.searchers[h[1]]=h[3]||""}}}})}}return e});c.add("compile",function(f){var d=this.token;var g=f||this.iControler.get(d.controler,d.views);var e=null;if(g.compile&&g.compile.length>0){fs(g.compile).exist().then(function(){var i=require(g.compile),h=function(){var j={};http.emit(Request.Form,function(k){var l=http.emit(Request.Form(k));j[k]=l&&l.length>1?l:l[0]});return j};if(typeof i==="function"){e=new i(d.searchers,h)}else{e=i}})}return e});c.add("render",function(){var e=this.token;var h=this.iControler.get(e.controler,e.views);var g=this;var f=null;var d=this.iEvent.get(e.controler);if(!d){return}if(h.type==="html"){fs(h.page).exist().fail(function(){g.error=404}).then(function(){f=g.compile(h);if(f){include(h.page,f)}else{include(h.page)}}).stop()}else{if(h.type==="json"){f=g.compile(h);if(f){console.json(f)}else{this.error=500}}else{if(h.type==="none"){this.compile(h)}else{console.log(this.compile(h))}}}});var a=new Class(function(){this.map={}});a.add("set",function(d,e,m,h,g){if(!e&&readVariableType(d,"string")){var n=require(d);for(var l in n){for(var k in n[l]){this.set(l,k,n[l][k].page,n[l][k].compile,n[l][k].type)}}}else{if(!this.map[d]){this.map[d]={}}if(!this.map[d][e]){var f={};if(m){f.page=m}if(h){f.compile=h}if(g){f.type=g}this.map[d][e]=f}}});a.add("get",function(e,d){if(this.map[e]&&this.map[e][d]){return this.map[e][d]}else{this.error=404}});var b=new Class(function(){this.map={}});b.add("set",function(d,e){if(!this.map[d]){this.map[d]=[]}if(typeof e==="function"){this.map[d].push(e)}});b.add("get",function(e){var d=true;if(this.map[e]){this.map[e].forEach(function(g){var f=g();if(f===false){d=false}})}return d});return c});