(function(a){if(typeof exports=="object"||typeof exports==="function"&&typeof module=="object"){module.exports=a()}else{if(typeof define=="function"&&define.amd){return define([],a)}else{window.iPress=a()}}})(function(){var c=new Class(function(){this.error=0;this.iControler=new a();this.iEvent=new b();if(typeof this.PressURL==="function"){this.token=this.PressURL(this.getURL())}else{this.token=this._PressURL(this.getURL())}});c.add("errors",{"0":"正常","404":"找不到页面地址","500":"服务端出错"});c.add("getURL",function(){var d=http.emit(Request.QueryString);if(d.length>0){return d[0]}else{return"page:home.html"}});c.add("setURL",function(h,d,k){var f="?"+h+":";if(d){f+="@"+d}var e=[],j="";if(k){for(var g in k){e.push(g+"("+k[g]+")")}}if(e.length>0){j="-"+e.join("-")}f+=j+".html";return f});c.add("_PressURL",function(d){var e={controler:"page",searchers:{},views:"home"};var f=d.split(":");if(f.length>1){e.controler=f[0];f=f[1].split(".");if(f.length>1){f=f[0].split("-");f.forEach(function(g){if(/^\@/.test(g)){e.views=g.replace(/^\@/,"")}else{if(/(\w+)(\(([^\)]+)\))?/.test(g)){var h=/(\w+)(\(([^\)]+)\))?/.exec(g);if(h&&h[1]){e.searchers[h[1]]=h[3]||""}}}})}}return e});c.add("compile",function(g){var e=this.token;var h=g||this.iControler.get(e.controler,e.views);var d=this.iEvent.get(e.controler);if(!d){return}var f=null;if(h.compile&&h.compile.length>0){fs(h.compile).exist().then(function(){var j=require(h.compile),i=function(){var k={};http.emit(Request.Form,function(l){var m=http.emit(Request.Form(l));k[l]=m&&m.length>1?m:m[0]});return k};f=new j(e.searchers,i)})}return f});c.add("render",function(){var d=this.token;var g=this.iControler.get(d.controler,d.views);var f=this;var e=null;if(g.type==="html"){fs(g.page).exist().fail(function(){f.error=404}).then(function(){e=f.compile(g);if(e){include(g.page,e)}else{include(g.page)}}).stop()}else{if(type==="json"){e=f.compile(g);if(e){console.json(e)}else{this.error=500}}else{console.log(f.compile(g))}}});var a=new Class(function(){this.map={}});a.add("set",function(d,e,m,h,g){if(!e&&readVariableType(d,"string")){var n=require(d);for(var l in n){for(var k in n[l]){this.set(l,k,n[l][k].page,n[l][k].compile,n[l][k].type)}}}else{if(!this.map[d]){this.map[d]={}}if(!this.map[d][e]){var f={};if(m){f.page=m}if(h){f.compile=h}if(g){f.type=g}this.map[d][e]=f}}});a.add("get",function(e,d){if(this.map[e]&&this.map[e][d]){return this.map[e][d]}else{this.error=404}});var b=new Class(function(){this.map={}});b.add("set",function(d,e){if(!this.map[d]){this.map[d]=[]}if(typeof e==="function"){this.map[d].push(e)}});b.add("get",function(e){var d=true;if(this.map[e]){this.map[e].forEach(function(g){var f=g();if(f===false){d=false}})}return d});return c});